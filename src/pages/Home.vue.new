<template>
  <div class="home-container">
    <!-- é¡¶éƒ¨æœç´¢åŒºåŸŸ -->
    <div class="search-section">
      <div class="brand">
        <div class="brand-content">
          <img :src="toolLogo" alt="logo" class="toollogo" />
          <h1 class="title">{{ isEnglish ? 'HUHA Developer Toolbox' : 'å‘¼å“ˆå¼€å‘è€…å·¥å…·ç®±' }}</h1>
        </div>
        
        <!-- æ·»åŠ æ“ä½œæŒ‰é’®ç»„ -->
        <div class="header-actions">
          <el-tooltip :content="isEnglish ? uiTextI18n.projectIntro.en : uiTextI18n.projectIntro.zh" placement="bottom">
            <el-button class="action-btn" @click="showAboutProject">
              <el-icon><InfoFilled /></el-icon>
            </el-button>
          </el-tooltip>
          
          <el-tooltip :content="isEnglish ? uiTextI18n.aboutAuthor.en : uiTextI18n.aboutAuthor.zh" placement="bottom">
            <el-button class="action-btn" @click="showAboutAuthor">
              <el-icon><User /></el-icon>
            </el-button>
          </el-tooltip>
          
          <el-tooltip content="GitHub" placement="bottom">
            <el-button class="action-btn" @click="openGitHub">
              <svg class="github-icon" viewBox="0 0 16 16" width="1em" height="1em">
                <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
              </svg>
            </el-button>
          </el-tooltip>

          <div class="divider"></div>

          <!-- ä¿®æ”¹ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
          <el-tooltip :content="isEnglish ? uiTextI18n.switchTheme.en : uiTextI18n.switchTheme.zh" placement="bottom">
            <button class="theme-toggle" @click="toggleTheme" :class="{ 'is-dark': isDarkMode }">
              <div class="toggle-icon">
                <el-icon>
                  <Moon v-if="!isDarkMode" />
                  <Sunny v-else />
                </el-icon>
              </div>
            </button>
          </el-tooltip>
          
          <!-- æ·»åŠ è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
          <el-tooltip :content="isEnglish ? uiTextI18n.switchLanguage.en : uiTextI18n.switchLanguage.zh" placement="bottom">
            <button class="language-toggle" @click="toggleLanguage" :class="{ 'is-english': isEnglish }">
              <div class="toggle-icon">
                <span>{{ isEnglish ? 'EN' : 'ä¸­' }}</span>
              </div>
            </button>
          </el-tooltip>
        </div>
      </div>

      <!-- æœç´¢åŒºåŸŸé‡æ–°è®¾è®¡ -->
      <div class="search-container">
        <div class="search-wrapper" :class="{ 'is-focused': isSearchFocused }">
          <div class="search-box">
            <el-icon class="search-icon">
              <Search />
            </el-icon>
            <input v-model="searchText" type="text" class="search-input" :placeholder="isEnglish ? uiTextI18n.searchPlaceholder.en : uiTextI18n.searchPlaceholder.zh"
              @focus="isSearchFocused = true" @blur="handleSearchBlur" @keyup.enter="handleSearch" />
            <div class="search-divider"></div>
            <div class="engine-selector" @click.stop="showEngineDropdown = true">
              <span class="engine-name">{{ isEnglish ? searchEnginesI18n[currentEngine.key].en : searchEnginesI18n[currentEngine.key].zh }}</span>
              <el-icon class="arrow-icon" :class="{ 'is-active': showEngineDropdown }">
                <ArrowDown />
              </el-icon>
            </div>
          </div>

          <!-- æœç´¢å¼•æ“ä¸‹æ‹‰èœå• -->
          <transition name="fade">
            <div v-if="showEngineDropdown" class="engine-dropdown">
              <div class="engine-list">
                <div v-for="engine in searchEngines" :key="engine.key" class="engine-item"
                  :class="{ active: currentEngine.key === engine.key }" @click="selectEngine(engine)">
                  <el-icon class="engine-icon">
                    <component :is="engine.icon" />
                  </el-icon>
                  <span class="engine-label">{{ isEnglish ? searchEnginesI18n[engine.key].en : searchEnginesI18n[engine.key].zh }}</span>
                  <el-icon v-if="currentEngine.key === engine.key" class="check-icon">
                    <Check />
                  </el-icon>
                </div>
              </div>
            </div>
          </transition>
        </div>

        <!-- èƒŒæ™¯é®ç½© -->
        <div class="search-backdrop" :class="{ 'is-visible': isSearchFocused || showEngineDropdown }"
          @click="handleBackdropClick"></div>
      </div>
    </div>

    <!-- æ·»åŠ ä¸€ä¸ªæ–°çš„æ»šåŠ¨å®¹å™¨ -->
    <div 
      class="tools-scroll-container" 
      :class="{ 'has-minimized-tools': minimizedTools.length > 0 }"
    >
      <!-- æ·»åŠ åˆ†ç±»æ ‡ç­¾åŒºåŸŸ -->
      <div class="category-tags">
        <el-radio-group v-model="currentCategory" size="large">
          <el-radio-button value="all">
            <el-icon>
              <Grid />
            </el-icon>
            {{ isEnglish ? categoriesI18n.all.en : categoriesI18n.all.zh }}
          </el-radio-button>
          <el-radio-button v-for="category in categories" :key="category.key" :value="category.key">
            <el-icon>
              <component :is="getCategoryIcon(category.key)" />
            </el-icon>
            {{ isEnglish ? categoriesI18n[category.key].en : categoriesI18n[category.key].zh }}
          </el-radio-button>
        </el-radio-group>
      </div>

      <!-- å·¥å…·å¡ç‰‡åŒºåŸŸ -->
      <div class="tools-section">
        <transition-group 
          name="fade" 
          tag="div" 
          class="tools-grid"
          :css="false"
        >
          <div 
            v-for="(tool, index) in paginatedTools" 
            :key="tool.code" 
            :data-index="index"
            class="tool-card" 
            @click="navigateToTool(tool)"
          >
            <div class="tool-icon">
              <img :src="tool.icon" :alt="getToolName(tool)" class="tool-icon-image"/>
            </div>
            <div class="tool-content">
              <h3 class="tool-title">{{ getToolName(tool) }}</h3>
              <p class="tool-desc">{{ getToolDescription(tool) }}</p>
            </div>
          </div>
        </transition-group>
      </div>
    </div>

    <!-- æ·»åŠ ç»Ÿè®¡ä¿¡æ¯æ¨¡å— -->
    <div class="stats-placeholder"></div>
    <div class="stats-section">
      <div class="stats-container">
        <div class="stats-content">
          <div class="stats-numbers">
            <div class="stat-item">
              <span class="stat-value">{{ toolsCount }}</span>
              <span class="stat-label">{{ isEnglish ? uiTextI18n.tools.en : uiTextI18n.tools.zh }}</span>
            </div>
            <div class="separator"></div>
            <div class="stat-item">
              <span class="stat-value">{{ categoriesCount }}</span>
              <span class="stat-label">{{ isEnglish ? uiTextI18n.categories.en : uiTextI18n.categories.zh }}</span>
            </div>
            <div class="separator"></div>
            <div class="stat-item">
              <span class="stat-value">v1.0.0</span>
              <span class="stat-label">{{ isEnglish ? uiTextI18n.version.en : uiTextI18n.version.zh }}</span>
            </div>
          </div>
          
          <div class="stats-divider"></div>
          
          <div class="stats-links">
            <a href="#" @click.prevent="openSourceLink">
              {{ isEnglish ? uiTextI18n.openSource.en : uiTextI18n.openSource.zh }}
            </a>
            <span class="dot">Â·</span>
            <a href="#" @click.prevent="openAuthorBlog">
              {{ isEnglish ? uiTextI18n.aboutAuthor.en : uiTextI18n.aboutAuthor.zh }}
            </a>
            <span class="dot">Â·</span>
            <a href="#" @click.prevent="showAboutProject">
              {{ isEnglish ? uiTextI18n.aboutProject.en : uiTextI18n.aboutProject.zh }}
            </a>
            <!-- <span class="dot">Â·</span>
            <a href="#" @click.prevent="showUserManual">
              ä½¿ç”¨è¯´æ˜
            </a> -->
          </div>
        </div>
      </div>
    </div>

    <!-- æ·»åŠ å¯¹è¯æ¡†ç»„ä»¶ -->
    <el-dialog
      v-model="showProjectDialog"
      :title="isEnglish ? 'About Project' : 'å…³äºé¡¹ç›®'"
      width="500px"
      class="about-dialog"
    >
      <div class="about-content">
        <h3>{{ isEnglish ? 'HUHA Developer Toolbox' : 'å‘¼å“ˆå¼€å‘è€…å·¥å…·ç®±' }}</h3>
        <p>{{ isEnglish ? 'An online toolbox that integrates common development tools, including the following features:' : 'ä¸€ä¸ªé›†æˆäº†å¸¸ç”¨å¼€å‘å·¥å…·çš„åœ¨çº¿å·¥å…·ç®±ï¼ŒåŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š' }}</p>
        <ul>
          <li>ğŸ› ï¸ {{ isEnglish ? 'Rich tool collection' : 'ä¸°å¯Œçš„å·¥å…·é›†åˆ' }}</li>
          <li>ğŸ¨ {{ isEnglish ? 'Elegant user interface' : 'ä¼˜é›…çš„ç”¨æˆ·ç•Œé¢' }}</li>
          <li>ğŸŒ™ {{ isEnglish ? 'Dark mode support' : 'æ”¯æŒæ·±è‰²æ¨¡å¼' }}</li>
          <li>ğŸ“± {{ isEnglish ? 'Responsive design' : 'å“åº”å¼è®¾è®¡' }}</li>
          <li>âš¡ {{ isEnglish ? 'Fast local operation' : 'å¿«é€Ÿçš„æœ¬åœ°è¿è¡Œ' }}</li>
        </ul>
        <p class="version">{{ isEnglish ? 'Current version: v1.0.0' : 'å½“å‰ç‰ˆæœ¬ï¼šv1.0.0' }}</p>
        <p>
          {{ isEnglish ? 'This tool was developed with the assistance of Cursor AI.' : 'æœ¬å·¥å…·ç”±Cursor AIè¾…åŠ©å¼€å‘ã€‚' }}
        </p>
      </div>
    </el-dialog>


    <el-dialog
      v-model="showAuthorDialog"
      :title="isEnglish ? 'About Author' : 'å…³äºä½œè€…'"
      width="500px"
      class="about-dialog"
    >
      <div class="about-content">
        <div class="author-info">
          <img :src="authorAvatar" alt="author" class="author-avatar" />
          <div class="author-details">
            <h3>HUHA</h3>
            <p>{{ isEnglish ? 'Rookie Developer / Lost Wanderer' : 'èœé¸Ÿå¼€å‘è€… / æ±Ÿæ¹–è¿·é€”å°ä¹¦ç«¥' }}</p>
          </div>
        </div>
        <div class="contact-info">
          <p>{{ isEnglish ? 'Contact:' : 'è”ç³»æ–¹å¼ï¼š' }}</p>
          <ul>
            <li>
              <el-icon><Message /></el-icon>
              <span>Email: wsyhok@126.com</span>
            </li>
            <li>
              <el-icon><Link /></el-icon>
              <a 
                href="https://huhage.github.io/huhawebsite" 
                target="_blank"
                class="blog-link"
                @click.stop="openBlog"
              >
                Blog: https://huhage.github.io/huhawebsite
              </a>
            </li>
          </ul>
        </div>
      </div>
    </el-dialog>

    <!-- ä½¿ç”¨æ–°ç»„ä»¶æ›¿æ¢åŸæœ‰çš„æœ€å°åŒ–å·¥å…·æ  -->
    <MinimizedToolsBar :has-stats="showStats" />

    <!-- æ·»åŠ ä½¿ç”¨è¯´æ˜å¯¹è¯æ¡† -->
    <el-dialog
      v-model="showManualDialog"
      :title="isEnglish ? 'User Manual' : 'ä½¿ç”¨è¯´æ˜'"
      width="800px"
      class="manual-dialog"
    >
      <div v-if="manualLoadError" class="manual-error">
        <div class="error-icon">
          <el-icon><WarningFilled /></el-icon>
        </div>
        <h3>{{ isEnglish ? 'Loading Failed' : 'åŠ è½½å¤±è´¥' }}</h3>
        <p>{{ isEnglish ? 'Sorry, the user manual failed to load. You can:' : 'å¾ˆæŠ±æ­‰ï¼Œä½¿ç”¨è¯´æ˜æ–‡æ¡£åŠ è½½å¤±è´¥ã€‚æ‚¨å¯ä»¥ï¼š' }}</p>
        <ul>
          <li>{{ isEnglish ? 'Check your network connection and try again' : 'æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•' }}</li>
          <li>{{ isEnglish ? 'Visit the online documentation' : 'è®¿é—®åœ¨çº¿æ–‡æ¡£' }}</li>
          <li>{{ isEnglish ? 'Contact technical support' : 'è”ç³»æŠ€æœ¯æ”¯æŒ' }}</li>
        </ul>
        <el-button type="primary" @click="retryLoadManual">{{ isEnglish ? 'Reload' : 'é‡æ–°åŠ è½½' }}</el-button>
      </div>
      <div v-else class="manual-content" v-html="manualContent"></div>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, watch, inject, nextTick } from 'vue'
import { useRouter } from 'vue-router'
import { keepAliveComponents } from '@/stores/keepAliveStore'
import { useTheme } from '@/composables/useTheme'
import { useLanguage } from '@/composables/useLanguage'
import { toolsI18n, categoriesI18n, searchEnginesI18n, uiTextI18n } from '@/config/i18n'
import {
  Search,
  ArrowDown,
  Document,
  Edit,
  Timer,
  Key,
  Grid,
  Histogram,
  Connection,
  Clock,
  Collection,
  Check,
  Sunny,
  Moon,
  InfoFilled,
  User,
  Message,
  Link,
  Tools,
  Platform,
  Close,
  Delete,
  ArrowRight,
  ArrowLeft,
  WarningFilled
} from '@element-plus/icons-vue'
import toolLogo from '@/assets/logo/tool_logo.png'
import jsonIcon from '@/assets/icons/json.svg'
import xmlIcon from '@/assets/icons/xml.svg'
import timestampIcon from '@/assets/icons/timestamp.svg'
import base64Icon from '@/assets/icons/base64.svg'
import urlIcon from '@/assets/icons/url.svg'
import uuidIcon from '@/assets/icons/uuid.svg'
import qrcodeIcon from '@/assets/icons/qrcode.svg'
import md5Icon from '@/assets/icons/md5.svg'
import unicodeIcon from '@/assets/icons/unicode.svg'
import httpIcon from '@/assets/icons/http.svg'
import idcardIcon from '@/assets/icons/idcard.svg'
import sqlIcon from '@/assets/icons/sql.svg'
import cronIcon from '@/assets/icons/cron.svg'
import regexIcon from '@/assets/icons/regex.svg'
import diffIcon from '@/assets/icons/diff.svg'
import sqlParamsIcon from '@/assets/icons/sql-params.svg'
import authorAvatar from '@/assets/avatar.png'
import creditIcon from '@/assets/icons/credit.svg'
import sqlFormatIcon from '@/assets/icons/sql-format.svg'
import configEditorIcon from '@/assets/icons/config.svg'
import linuxIcon from '@/assets/icons/linux.svg'
import aesIcon from '@/assets/icons/aes.svg'
import rsaIcon from '@/assets/icons/rsa.svg'
import sqlZHIcon from '@/assets/icons/sql-zh.svg'
import sqlTruncateIcon from '@/assets/icons/sql-truncate.svg'
import sqlAddIcon from '@/assets/icons/sql-add.svg'
import wordToHtmlIcon from '@/assets/icons/word-to-html.svg'
import hanBao from '@/assets/icons/æ±‰å ¡.svg'
import lanQiu from '@/assets/icons/ç¯®çƒ.svg'
import lotteryIcon from '@/assets/icons/æŠ½å¥–.svg'
import pixelBreakoutIcon from '@/assets/icons/pixel-breakout.svg' // æ·»åŠ è¿™ä¸€è¡Œ
import tanchisheIcon from '@/assets/icons/è´ªåƒè›‡.svg'
import fanyinliIcon from '@/assets/icons/ååº”åŠ›.svg'

import { minimizeTools } from '@/stores/minimizeTools'
import { MinimizeTools } from '@/stores/minimizeTools'
import { ElMessageBox, ElMessage } from 'element-plus'
import { marked } from 'marked'
import axios from 'axios'
import MinimizedToolsBar from '@/components/MinimizedToolsBar.vue'
import { tools } from '@/config/tools'
import { track } from '@vercel/analytics'

const isSearchFocused = ref(false)
const showEngineDropdown = ref(false)
const { isDarkMode, toggleTheme } = useTheme()
const { isEnglish, toggleLanguage } = useLanguage()

// æœç´¢å¼•æ“é…ç½®
const searchEngines = [
  { key: 'local', name: 'ç«™å†…æœç´¢', url: '', icon: Document },
  { key: 'google', name: 'Google', url: 'https://www.google.com/search?q=', icon: Search },
  { key: 'bing', name: 'Bing', url: 'https://www.bing.com/search?q=', icon: Search },
  { key: 'baidu', name: 'ç™¾åº¦', url: 'https://www.baidu.com/s?wd=', icon: Search }
]

const currentEngine = ref(searchEngines[0])
const searchText = ref('')
const router = useRouter()

// å·¥å…·åˆ†ç±»é…ç½®
const categories = [
  { key: 'format', name: 'æ ¼å¼åŒ–', icon: Document },
  { key: 'encode', name: 'ç¼–è§£ç ', icon: Connection },
  { key: 'convert', name: 'è½¬æ¢', icon: Histogram },
  { key: 'generate', name: 'ç”Ÿæˆ', icon: Collection },
  { key: 'sql', name: 'SQLå·¥å…·', icon: Connection }, // æ·»åŠ  SQL å·¥å…·åˆ†ç±»
  { key: 'other', name: 'å…¶ä»–', icon: Grid },
  { key: 'fun', name: 'è¶£å‘³', icon: Grid },
]

const currentCategory = ref('all')

// è·å–å·¥å…·åç§°ï¼ˆæ”¯æŒå¤šè¯­è¨€ï¼‰
const getToolName = (tool) => {
  if (toolsI18n[tool.code]) {
    return isEnglish.value ? toolsI18n[tool.code].en.name : toolsI18n[tool.code].zh.name
  }
  return tool.name
}

// è·å–å·¥å…·æè¿°ï¼ˆæ”¯æŒå¤šè¯­è¨€ï¼‰
const getToolDescription = (tool) => {
  if (toolsI18n[tool.code]) {
    return isEnglish.value ? toolsI18n[tool.code].en.description : toolsI18n[tool.code].zh.description
  }
  return tool.description
}

// ä¿®æ”¹è¿‡æ»¤å·¥å…·çš„è®¡ç®—å±æ€§
const filteredTools = computed(() => {
  let filtered = tools

  // æŒ‰åˆ†ç±»ç­›é€‰
  if (currentCategory.value !== 'all') {
    filtered = filtered.filter(tool => 
      Array.isArray(tool.category) 
        ? tool.category.includes(currentCategory.value)
        : tool.category === currentCategory.value
    )
  }

  // æŒ‰æœç´¢å…³é”®è¯ç­›é€‰
  if (searchText.value) {
    const keyword = searchText.value.toLowerCase()
    filtered = filtered.filter(tool => {
      const name = getToolName(tool).toLowerCase()
      const description = getToolDescription(tool).toLowerCase()
      return name.includes(keyword) || description.includes(keyword)
    })
  }

  return filtered
})

// è·å–åˆ†ç±»åç§°
const getCategoryName = (categoryKey: string) => {
  const category = categories.find(c => c.key === categoryKey)
  return category ? category.name : ''
}

// è·å–åˆ†ç±»å›¾æ ‡
const getCategoryIcon = (categoryKey: string) => {
  const category = categories.find(c => c.key === categoryKey)
  return category ? category.icon : Document
}

// å¤„ç†æœç´¢å¼•æ“åˆ‡æ¢
const handleSearchEngine = (engineKey: string) => {
  currentEngine.value = searchEngines.find(engine => engine.key === engineKey) || searchEngines[0]
}

// å¤„ç†æœç´¢
const handleSearch = () => {
  if (!searchText.value) return

  if (currentEngine.value.key === 'local') {
    // ç«™å†…æœç´¢é€»è¾‘
    return
  }

  // ä½¿ç”¨å¤–éƒ¨æœç´¢å¼•æ“
  window.utools.shellOpenExternal(currentEngine.value.url + encodeURIComponent(searchText.value))
}

// å¯¼èˆªåˆ°å·¥å…·é¡µé¢
const navigateToTool = (tool: typeof tools[0]) => {
  if (tool.path.startsWith('http')) {
    // å¯¹äºå¤–éƒ¨é“¾æ¥ï¼Œä½¿ç”¨æ–°çª—å£æ‰“å¼€
    if (window.utools) {
      window.utools.shellOpenExternal(tool.path)
    } else {
      window.open(tool.path, '_blank')
    }
  } else {
    // å†…éƒ¨è·¯ç”±å¯¼èˆªä¿æŒä¸å˜
    router.push(tool.path)
  }
}

const handleSearchBlur = () => {
  // å»¶è¿Ÿå…³é—­ç„¦ç‚¹çŠ¶æ€ï¼Œä»¥ä¾¿ç‚¹å‡»ä¸‹æ‹‰èœå•æ—¶ä¸ä¼šç«‹å³å…³é—­
  setTimeout(() => {
    if (!showEngineDropdown.value) {
      isSearchFocused.value = false
    }
  }, 100)
}

const selectEngine = (engine: typeof searchEngines[0]) => {
  currentEngine.value = engine
  showEngineDropdown.value = false
}

const handleBackdropClick = () => {
  isSearchFocused.value = false
  showEngineDropdown.value = false
}

// åˆå§‹åŒ–ä¸»é¢˜å’Œè¯­è¨€
onMounted(() => {
  // ä¼˜å…ˆä½¿ç”¨å­˜å‚¨çš„ä¸»é¢˜è®¾ç½®
  const savedTheme = localStorage.getItem('theme')
  if (savedTheme) {
    isDarkMode.value = savedTheme === 'dark'
  } else {
    // å¦åˆ™ä½¿ç”¨ç³»ç»Ÿä¸»é¢˜
    isDarkMode.value = window.matchMedia('(prefers-color-scheme: dark)').matches
  }
  document.documentElement.classList.toggle('dark', isDarkMode.value)

  // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      isDarkMode.value = e.matches
      document.documentElement.classList.toggle('dark', isDarkMode.value)
    }
  })
})

// å¯¹è¯æ¡†æ§åˆ¶
const showProjectDialog = ref(false)
const showAuthorDialog = ref(false)

// æŒ‰é’®äº‹ä»¶å¤„ç†
const showAboutProject = () => {
  showProjectDialog.value = true
}

const showAboutAuthor = () => {
  showAuthorDialog.value = true
}

const openGitHub = () => {
  const url = 'https://gitee.com/huhage/programmers-assistant-utools/tree/master'
  
  // åˆ¤æ–­æ˜¯å¦åœ¨ uTools ç¯å¢ƒä¸­
  if (window.utools) {
    window.utools.shellOpenExternal(url)
  } else {
    // åœ¨æ™®é€šæµè§ˆå™¨ç¯å¢ƒä¸­ä½¿ç”¨ window.open
    window.open(url, '_blank')
  }
}

const openBlog = (e: MouseEvent) => {
  e.preventDefault()
  const url = 'https://huhage.github.io/huhawebsite'
  
  if (window.utools) {
    window.utools.shellOpenExternal(url)
  } else {
    window.open(url, '_blank')
  }
}

// åœ¨ tools-section åé¢æ·»åŠ æ–°çš„ç»Ÿè®¡æ¨¡å—
const toolsCount = computed(() => tools.length)
const categoriesCount = computed(() => categories.length)

// ç§»é™¤åˆ†é¡µç›¸å…³çš„è®¡ç®—å±æ€§,ç›´æ¥ä½¿ç”¨è¿‡æ»¤åçš„å·¥å…·åˆ—è¡¨
const paginatedTools = computed(() => {
  return filteredTools.value
})

// ç›‘å¬ç­›é€‰æ¡ä»¶å˜åŒ–ï¼Œé‡ç½®é¡µç 
watch([searchText, currentCategory], () => {
  // ç§»é™¤åˆ†é¡µç›¸å…³çš„çŠ¶æ€å’Œæ–¹æ³•
  // åˆ é™¤:
  // currentPage.value = 1
  // pageSize.value = 12
  // handlePageChange = (page: number) => {
  //   currentPage.value = page
  // }
})

const minimizeTools = inject('minimizeTools') as MinimizeTools

// æ·»åŠ ä¸€ä¸ªè®¡ç®—å±æ€§æ¥è·å–æ’åºåçš„æœ€å°åŒ–å·¥å…·åˆ—è¡¨
const minimizedTools = computed(() => {
  return minimizeTools.tools
})

const openMinimizedTool = (tool: MinimizedTool) => {
  // ç¡®ä¿ç›®æ ‡ç»„ä»¶è¢«åŒ…å«åœ¨ keep-alive ä¸­
  if (!keepAliveComponents.value.includes(tool.component)) {
    keepAliveComponents.value.push(tool.component)
  }
  // ç­‰å¾… DOM æ›´æ–°åå†å¯¼èˆª
  nextTick(() => {
    router.push(tool.path)
  })
}

const closeMinimizedTool = (tool: MinimizedTool) => {
  minimizeTools.remove(tool.path)
}

// æ·»åŠ ä¸€ä¸ªè®¡ç®—å±æ€§æ¥åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºç»Ÿè®¡åŒº